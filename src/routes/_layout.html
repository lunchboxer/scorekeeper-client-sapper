<Nav segment={child.segment} />
<div class="container">
  <main>
    <svelte:component this={child.component} {...child.props} />
  </main>

</div>
<NotificationList></NotificationList>

<style>
  .container {
    margin: 0;
  }
</style>

<script>
  import client from '../utils/feathers'

  export default {
    components: {
      Nav: '../components/Nav.html',
      NotificationList: "../components/NotificationList.html"
    },
    oncreate() {
      client.authenticate().catch(this.store.set({ user: null, login: null }))
      client.on('authenticated', this.authenticatedListener.bind(this))
      client.on('logout', this.logoutListener.bind(this))
    },
    methods: {
      async authenticatedListener(res) {
        const payload = await client.passport.verifyJWT(res.accessToken)
        const user = await client.service('users').get(payload.userId)
        const groups = await client.service('student-groups').find()
        this.store.set({ user, login: res.accessToken, groups: groups.data })
      },
      logoutListener() {
        this.store.set({ user: null, login: null })
      }
    }
  };
</script>