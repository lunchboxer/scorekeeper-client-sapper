<Nav segment={child.segment} />
<div class="container">
  <main>
    <svelte:component this={child.component} {...child.props} />
  </main>

</div>
<NotificationList></NotificationList>


<style>
  .container {
    margin-top: 1rem;
  }
</style>

<script>
  import client from '../utils/feathers'
  import store from '../utils/store.js'

  export default {
    components: {
      Nav: '../components/Nav.html',
      NotificationList: "../components/NotificationList.html"
    },
    store: () => store,
    oncreate() {
      // for debugging purposes
      // window.store = store
      client.authenticate().catch(store.set({ user: null, login: null }))
      client.on('authenticated', this.authenticatedListener)
      client.on('logout', this.logoutListener)
    },
    methods: {
      async authenticatedListener(res) {
        const payload = await client.passport.verifyJWT(res.accessToken)
        const user = await client.service('users').get(payload.userId)
        const groups = await client.service('student-groups').find()
        store.set({ user, login: res.accessToken, groups: groups.data })
      },
      logoutListener() {
        store.set({ user: null, login: null })
      }
    }
  };
</script>